# ----------------------------------------------------------------------------
# Challenge #9:
# ----------------------------------------------------------------------------

##############################################################################
# Do not change any existing configuration only add new ones!                #
##############################################################################

<VirtualHost *:80>
    ServerAdmin webmaster@example.com
    DocumentRoot /var/www/html

    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    # R1: Limiting maximum number of header fields and their size
    LimitRequestFields 50
    LimitRequestFieldSize 1024

    # R2: Limiting maximum size of request body
    LimitRequestBody 2097152

    # R3: Limiting timeout for TCP packets
    Timeout 20

    <Directory /var/www/html>
        AllowOverride AuthConfig Limit

        # R8: Limiting HTTP request methods
        <LimitExcept GET POST HEAD OPTIONS>
            Deny from all
        </LimitExcept>

    </Directory>

    # R4: Restrict access to /admin URL for private IP ranges
    <Location /admin>
        Order Deny,Allow
        Deny from all
        Allow from 10.0.0.0/8
        Allow from 172.16.0.0/12
        Allow from 192.168.0.0/16
    </Location>

    # R5: Avoid client-side MIME type sniffing
    Header set X-Content-Type-Options "nosniff"

    # R6: Prevent client-side click-jacking attacks
    Header set X-Frame-Options "SAMEORIGIN"

    # R7: Configuration for mod_evasive
    <IfModule mod_evasive20.c>
        DOSWhitelist 127.0.0.1
    </IfModule>

    # R9: Disable HTTP 1.0 protocol
    <IfModule mod_setenvif.c>
        <Location />
            BrowserMatch "HTTP/1.0" bad_protocol
            Deny from env=bad_protocol
        </Location>
    </IfModule>

</VirtualHost>